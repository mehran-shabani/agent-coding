# ๐ Master Instructions โ Build the Local Coding Agent

# โ๏ธ ุงู ุณูุฏ ฺฉุฏ ููููู ุงุฑุงุฆู ููโฺฉูุฏุ ููุท ยซฺฏุงูโูุงุ ูุฑุงุฑุฏุงุฏูุง ู ูุนุงุฑูุง ูพุฐุฑุดยป ุฑุง ูุดุฎุต ูโููุงุฏ.

---

## 0) ูุญุฏูุฏุชโูุง ู ุงุตูู

- ููุท ุจู ุตูุฑุช ููฺฉุงูุ ูุงุฒ ุจู ูฺ ุงุญุฑุงุฒ ููุช ุฌุฒ **LLM\_API\_KEY** ู **LLM\_BASE\_URL** ูุฏุงุฑุฏ.
- ุจุงุฏ ุงุฒ ฺฉุชุงุจุฎุงููโูุง ุฒุฑ ุงุณุชูุงุฏู ุดูุฏ:
  - **Typer** ุจุฑุง CLI
  - **Rich** ุจุฑุง ููุงุด ุฑูฺฏ ู ุฎูุงูุง
  - **OpenAI Client** ุจุฑุง ุงุฑุชุจุงุท ุจุง LLM (ุจุง ุงูฺฉุงู ุชุนู base\_url ู api\_key)
  - **python-dotenv** ุจุฑุง ุจุงุฑฺฏุฐุงุฑ ุชูุธูุงุช ูุญุท
  - **Pydantic** ุจุฑุง ูุฏุฑุช ุชูุธูุงุช ู ุฏุงุฏูโูุง
- ุงุฌุฑุง ุฏุณุชูุฑุงุช ุดูู ู ุนููุงุช ูุงู ุจุงุฏ **ุงูู** ู ุจุง ุชุฃุฏ ฺฉุงุฑุจุฑ ุจุฑุง ุงูุฏุงูุงุช ูุฎุฑุจ (ุญุฐู / ุจุงุฒููุณ / ุงุนูุงู Patch) ุงูุฌุงู ุดูุฏ.
- ูุฑ ยซุชูุงูุถยป ุฏุฑ ุฏุณุชูุฑุงูุนููโูุง ุง ุงูุฒุงูุงุช โ ูุฑุงูุฏ ุฑุง **ูุชููู** ฺฉูุฏุ ฺฏุฒุงุฑุด ุจุณุงุฒุฏ (`.agent/reports/contradictions-<ts>.md`) ู ุงุฒ ุงุฏุงููู ุฎูุฏฺฉุงุฑ ุฎูุฏุฏุงุฑ ฺฉูุฏ.
- ุฒุจุงู ุฑุงุจุท CLI: ุงูฺฏูุณ ฺฉูุชุงูุ ูพุงูโูุง ุฑุงูููุง ู README: ูุงุฑุณ ุฑุณู.
- ูพุดโูุฑุถ LLM ุฑู **GapGPT** ุจุงุดุฏุ ุงูฺฉุงู ุชุบุฑ ุจุง ูุชุบุฑ ูุญุท ูุฑุงูู ุจุงุดุฏ.

---

## 1) ุฎุฑูุฌ ููุง

1. ฺฉ ูุฎุฒู ุจุง ุณุงุฎุชุงุฑ ุฏูู ุฒุฑ ุณุงุฎุชู ุดูุฏ:

   - `pyproject.toml`
   - `README.md`
   - `.env.example`
   - `.gitignore`
   - `agent/`
     - `cli.py`
     - `config.py`
     - `llm.py`
     - `analyze.py`
     - `state.py`
     - `prompts.py`
     - `tools/`
       - `fs.py`
       - `shell.py`
       - `patch.py`
   - `.agent/`
     - `logs/`
     - `reports/`
     - `state.json`

2. CLI ุจุง ูุงู ุจุงูุฑ `lca` ุณุงุฎุชู ุดูุฏ ู ุฒุฑูุฑูุงูโูุง ุฒุฑ ุฑุง ูพุดุชุจุงู ฺฉูุฏ:

   - `whoami`
   - `analyze`
   - `ask`
   - `plan`
   - `todo (add|list|done)`
   - `run`
   - `write`
   - `edit`
   - `delete`
   - `patch`

3. ุชุณุชโูุง ุฏุณุช ูุทุงุจู ฺฺฉโูุณุช ุจุฎุด 8 ุงุฌุฑุง ุดูุฏ.

---

## 2) ูพฺฉุฑุจูุฏ ู ูุญุท

- ูุงู `.env.example` ุดุงูู ฺฉูุฏูุง ุฒุฑ ุจุงุดุฏ:
  - `LLM_API_KEY`
  - `LLM_BASE_URL` โ ููุฏุงุฑ ูพุดโูุฑุถ: **[https://api.gapgpt.app/v1](https://api.gapgpt.app/v1)**
  - `LLM_MODEL` โ ููุฏุงุฑ ูพุดโูุฑุถ: `gpt-5o`
  - `AGENT_WORKDIR` โ ูพุดโูุฑุถ: `.`
  - `AGENT_LOG_DIR` โ ูพุดโูุฑุถ: `.agent/logs`
  - `AGENT_STATE` โ ูพุดโูุฑุถ: `.agent/state.json`
- ุงฺฏุฑ `LLM_API_KEY` ุชุนุฑู ูุดุฏู ุจุงุดุฏุ ุงุฌุฑุง CLI ูุชููู ุดูุฏ ู ูพุงู ุฎุทุง ุฑูุดู ููุงุด ุฏุงุฏู ุดูุฏ.

---

## 3) ูุฑุงุฑุฏุงุฏูุง ุทุฑุงุญ

- **CLI** ุจุงุฏ ุจุง Typer ูพุงุฏูโุณุงุฒ ุดูุฏ. ูุฑ ุฒุฑูุฑูุงู `--help` ฺฉุงูู ุฏุงุดุชู ุจุงุดุฏ.
- **ุฎุฑูุฌ ุชุฑููุงู** ุจุงุฏ ุจุง Rich ููุงุด ุฏุงุฏู ุดูุฏุ ููููุช ู ุฎุทุง ุจุง ฺฉุฏ ุฎุฑูุฌ ููุงุณุจ ูุดุฎุต ุดูุฏ.
- **LLM** ุจุงุฏ ุงุฒ ฺฉูุงูุช OpenAI ุงุณุชูุงุฏู ฺฉูุฏ:
  - ูพุงุฑุงูุชุฑูุง `api_key` ู `base_url` ุงุฒ `.env` ุจุงุฑฺฏุฐุงุฑ ุดูุฏ.
  - ุงุจุชุฏุง ูุชุฏ `responses.create` ุงุณุชูุงุฏู ุดูุฏุ ุงฺฏุฑ ุฎุทุง ุฑุฎ ุฏุงุฏุ ุงุฒ `chat.completions.create` ุงุณุชูุงุฏู ุดูุฏ.
- **ุชุญูู ูพุฑูฺู** ุจุงุฏ ุดุงูู ุงุณฺฉู ฺฉู ุฏุงุฑฺฉุชูุฑุ ููุงุด ุงูุฏุงุฒู ูุงูโูุงุ ุฒุจุงูโูุง ู ุงุณุชุฎุฑุงุฌ ููุงุฏูุง ูพุงุชูู (ฺฉูุงุณโูุงุ ุชูุงุจุนุ ุฏุงฺฉโุงุณุชุฑูฺฏโูุง) ุจุงุดุฏ. ูุชุฌู ุฏุฑ `CODEMAP.md` ุฐุฎุฑู ุดูุฏ.
- **Patch** ุจุงุฏ ุจู ุตูุฑุช unified diff ุชููุฏ ุดูุฏ ู ูุจู ุงุฒ ุงุนูุงู ููุงุด ุฏุงุฏู ุดูุฏ. ุงุนูุงู ุชุบุฑ ููุท ุจุง ุชุฃุฏ ุง ููฺฏ `--apply/--yes` ูุฌุงุฒ ุงุณุช.
- **ุงุฌุฑุง ุดูู** ุจุงุฏ ุฏุฑ `AGENT_WORKDIR` ุงูุฌุงู ุดูุฏ ู ุฎุฑูุฌ ุฏุฑ `.agent/logs/commands-<ts>.log` ุฐุฎุฑู ุดูุฏ.
- **TODO** ุจุงุฏ ุฏุฑ `.agent/state.json` ุฐุฎุฑู ุดูุฏ. ุฎุฑูุฌ `todo list` ุจุงุฏ ุจู ุตูุฑุช Markdown ูุฒ ููุงุด ุฏุงุฏู ุดูุฏ.
- **ุงูู ูุงู**: ูุฑ ุนููุงุช ุญุฐู ุง ุจุงุฒููุณ ุจุงุฏ ุชุฃุฏ ฺฉุงุฑุจุฑ ุฏุงุดุชู ุจุงุดุฏุ ุชููุง ุฏุฑ ุตูุฑุช `--yes` ุจุฏูู ุชุฃุฏ ุงูุฌุงู ุดูุฏ.
- **ฺฏุฒุงุฑุด ุชูุงูุถ**: ูุฑ ุชูุงูุถ ุจุงุฏ ุฏุฑ `.agent/reports/` ุฐุฎุฑู ุดูุฏ ู ุงุฌุฑุง CLI ูุชููู ฺฏุฑุฏุฏ.

---

## 4) ุฑูุชุงุฑ ุฒุฑูุฑูุงูโูุง

- `whoami`: ููุงุด ุงุทูุงุนุงุช ูพฺฉุฑุจูุฏ.
- `analyze [PATH]`: ุชููุฏ `CODEMAP.md`.
- `ask "..."`: ูพุฑุณุด ุขุฒุงุฏ ู ุฏุฑุงูุช ูพุงุณุฎ ูุชู.
- `plan "ูุฏู"`: ุชููุฏ ฺฏุงูโูุง ู ุงูุฒูุฏู ุจู TODO.
- `todo add|list|done`: ูุฏุฑุช TODO.
- `run "CMD"`: ุงุฌุฑุง ูุฑูุงู ุดูู.
- `write --path <file> --from "desc" [--overwrite]`: ุชููุฏ ูุงู.
- `edit --path <file> --inst "instruction"`: ูุฑุงุด ูุงู ุจุง ูพฺ.
- `delete --path <path> [--yes]`: ุญุฐู ูุงู/ูพูุดู.
- `patch --from "desc" [--apply]`: ุฏุฑุงูุช ู ุงุนูุงู Patch.

---

## 5) ุซุจุช ู ูุงฺฏ

- ูููู ุนููุงุช ุจุงุฏ ุฏุฑ `.agent/logs/` ุจุง timestamp ุฐุฎุฑู ุดููุฏ.
- ุฎุทุงูุง ุจุงุฏ ุจุง ูพุงู ูุงุถุญ ู ฺฉุฏ ุฎุฑูุฌ ุบุฑุตูุฑ ุฎุงุชูู ุงุจูุฏ.
- `CODEMAP.md` ุจุงุฏ ุชุงุฑุฎ ู ูุณุฑ ุงุณฺฉู ุฑุง ุฏุงุดุชู ุจุงุดุฏ.

---

## 6) ูพุฑุงููพุชโูุง ูพุงู

- System: ยซุชู ฺฉ ุงุฌูุช ฺฉุฏููุณ ููฺฉุงู ูุณุชุ ููุท ุฏุฑ workspace ุชุนูโุดุฏู ฺฉุงุฑ ฺฉูุ ุชุบุฑุงุช ุฑุง ุจู ุตูุฑุช unified diff ุงุฑุงุฆู ุจุฏูุ ูพุงุณุฎโูุง ฺฉูุชุงู ู ุงูู ุจุงุดูุฏ.ยป
- ุชููุฏ ูุงู: ยซุชูุถุญ ุฑุง ุจู ูุงู ุงุฌุฑุง ุชุจุฏู ฺฉูุ ุณุงุฎุชุงุฑ ุณุงุฏู ู ูููุงู ุจุงุดุฏ.ยป
- ูุฑุงุด ูุงู: ยซููุท ุจุฎุดโูุง ูุงุฒู ุชุบุฑ ฺฉูุฏุ ุฎุฑูุฌ unified diff ุจุงุดุฏ.ยป
- ูพฺ ฺูุฏูุงู: ยซูพฺ ฺูุฏูุงู ุจุง ูุณุฑ ูุณุจ ุงุฒ ุฑุดูู ูพุฑูฺู ุจุฏูุ ูุฑ ูุงู ุฏุฑ hunk ุฌุฏุง ุจุงุดุฏ.ยป

---

## 7) ูุนุงุฑ ูพุฐุฑุด

- ูุตุจ ุจุง `pip install -e .` ุจุฏูู ุฎุทุง.
- ุงุฌุฑุง `lca --help` ูุณุช ุฒุฑูุฑูุงูโูุง ุฑุง ูุดุงู ุฏูุฏ.
- ุงุฌุฑุง `lca whoami` ุงุทูุงุนุงุช ุฏุฑุณุช ุฑุง ููุงุด ุฏูุฏ.
- ุงุฌุฑุง `lca analyze` ูุงู `CODEMAP.md` ุงุฌุงุฏ ฺฉูุฏ.
- ุงุฌุฑุง `lca run "echo test"` ุฎุฑูุฌ ููุงุณุจ ุจุฏูุฏ ู ูุงฺฏ ุฐุฎุฑู ุดูุฏ.
- ุงุฌุฑุง `write` ู `edit` ุฑูุชุงุฑ ุงูู ุฏุงุดุชู ุจุงุดูุฏ.
- ุงุฌุฑุง `patch --from` ูพฺ ูุนุชุจุฑ ุงุฌุงุฏ ฺฉูุฏ.
- TODO ฺุฑุฎู addโlistโdone ุฑุง ูพุดุชุจุงู ฺฉูุฏ.

---

## 8) ฺฺฉโูุณุช ุชุญูู

-

---

## 9) ุฑุงูุจุฑุฏ ุฎุทุง ู ุจุงุฒุงุจ

- ุฎุทุง ุดุจฺฉู LLM: ุณู ุจุงุฑ ุชูุงุด ูุฌุฏุฏุ ุณูพุณ ุฎุฑูุฌ ุจุง ูพุงู ุฑุงูููุง.
- ุฎุทุง ุฏุณุชุฑุณ ูุงู: ูพุงู ุฑูุดู + ูพุดููุงุฏ ุฑูุน.
- ูพฺ ูุงูุนุชุจุฑ: ุฐุฎุฑู ุฏุฑ `.agent/reports/invalid-patch-<ts>.diff` ู ุชููู.

---

## 10) ุฌุฑุงู ฺฉุงุฑ ูุฎุฒู ู PR

- ุดุงุฎูู ฺฉุงุฑ: `feature/local-coding-agent/<agent-id>`.
- Commitโูุง ุงุชูฺฉ ู ุชูุตู ุจุงุดูุฏ.
- PR ุจู ุดุงุฎูู `develop` ุจุง ุจุฑฺุณุจโูุง `agent`, `cli`, `llm`, `safety`, `ready-for-review`.
- ุฏุฑ ุตูุฑุช ุชูุงูุถ: PR ุจุง ุจุฑฺุณุจ `blocked-contradiction` ู ฺฏุฒุงุฑุด.

---

## 11) ูฺฉุงุช ุงููุช

- ูุญุชูุง `.env` ูุฑฺฏุฒ ูุงฺฏ ูุดูุฏ.
- ูุณุฑูุง ุจุงุฏ CrossโPlatform ุจุงุดูุฏ.
- ุงุฌุฑุง ุบุฑุชุนุงูู ููุท ุจุง ููฺฏ ูุฌุงุฒ ุจุงุดุฏ.

---

## 12) ุฒูุงูโุจูุฏ ุงุฌุฑุง ุงุฌูุชโูุง

- ูุงุฒ 1: ุณุงุฎุชุงุฑ ูุงูโูุง ู CLI ุงููู.
- ูุงุฒ 2: ุงุจุฒุงุฑูุง (`fs`, `shell`, `patch`).
- ูุงุฒ 3: ูุงู LLM ู ูพุฑุงููพุชโูุง.
- ูุงุฒ 4: ูุงฺูู ุชุญูู (`analyze`).
- ูุงุฒ 5: ูุงฺูู state ู TODO.
- ูุงุฒ 6: ฺฏุฒุงุฑุด ุชูุงูุถุ ูุงฺฏโูุง ู PR.

---

## 13) ุฌูุนโุจูุฏ

ุงู ุฏุณุชูุฑุงูุนูู ุจุงุฏ ููุฌุฑ ุจู ุณุงุฎุช ฺฉ ุงุฌูุช ฺฉุฏููุณ ููฺฉุงู ูุฏุฑู ู ุงูู ุดูุฏ ฺฉู ุจู ุทูุฑ ูพุดโูุฑุถ ุจู **GapGPT** ูุชุตู ุงุณุชุ ุชูุงู ุนููุงุช ูุงู ู ุดูู ุฑุง ุฏุฑ ููฺฉุงู ุงูุฌุงู ูโุฏูุฏ ู ุชุบุฑุงุช ูพุฑูฺู ุฑุง ุจุง ุฒุจุงู ุทุจุน ูุฏุฑุช ูโฺฉูุฏ.

